<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Lidar Visualisation</title>
<style>
  canvas { background: #111; display:block; margin: auto; }
</style>
</head>
<body>
<canvas id="lidarCanvas" width="3000" height="3000"></canvas>
<script>
const canvas = document.getElementById("lidarCanvas");
const ctx = canvas.getContext("2d");
const width = canvas.width;
const height = canvas.height;
const centerX = width/2;
const centerY = height/2;
const scale = 0.5; // ajuster selon distance max LIDAR

let lidarPoints = []; // tableau pour garder tous les points
const MAX_POINTS = 8192;



// Fonction pour charger le fichier CSV
async function loadLidarData() {
    try {
        const resp = await fetch("lidar_data.csv");
        const text = await resp.text();
        lidarPoints = [];
        const lines = text.split("\n");
        for(const line of lines){
            if(line.trim()==="") continue;
            const [angle, dist] = line.split(",").map(Number);
            if(dist>0) lidarPoints.push({angle, dist});
        }
    } catch(e) {
        console.error("Impossible de lire le CSV", e);
    }
}

// Fonction pour dessiner le radar
function draw() {
    ctx.clearRect(0,0,width,height);

    // Rond représentant le LIDAR
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.arc(centerX, centerY, 5, 0, Math.PI*2);
    ctx.fill();


    // Dessiner les points LIDAR
    ctx.fillStyle = "lime";
    for(const p of lidarPoints){
        const rad = p.angle * Math.PI/180;
        const x = centerX + p.dist * scale * Math.cos(rad);
        const y = centerY + p.dist * scale * Math.sin(rad);
        ctx.fillRect(x, y, 2, 2);
    }
}

// Animation loop
function animate() {
    draw();
    requestAnimationFrame(animate);
}

// Rafraîchissement rapide du CSV toutes les 100ms
setInterval(loadLidarData, 50);
animate();
</script>
</body>
</html>
